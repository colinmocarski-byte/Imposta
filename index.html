<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Whosus? â€“ Impostor (Multi-Kategorien)</title>
<style>
  :root{--bg:#0f172a;--card:#0b1222;--ink:#e5e7eb;--mut:#9ca3af;--acc:#22c55e;--warn:#f59e0b;--bad:#ef4444}
  *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial;background:linear-gradient(180deg,#0b1022,#0f172a 45%,#0a1024);color:var(--ink)}
  .wrap{max-width:980px;margin:auto;padding:18px}
  h1{font-size:22px;margin:0 0 8px} h2{margin:0 0 10px}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:14px;margin:12px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
  .pill{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid #1f2937;background:#0e1630;color:var(--ink)}
  .muted{color:var(--mut)} .small{font-size:12px}
  input,select{background:#0a142e;border:1px solid #1f2937;border-radius:10px;padding:10px;color:var(--ink);width:100%}
  button{appearance:none;background:#0a142e;border:1px solid #1f2937;color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  button:hover{border-color:#334155} .primary{background:var(--acc);border-color:#16a34a;color:#07101f}
  .ghost{background:transparent}
  .danger{background:var(--bad);border-color:#dc2626;color:#fff}
  .big{font-size:22px}
  .center{display:flex;justify-content:center;align-items:center}
  .timer{height:10px;background:#0a142e;border:1px solid #1f2937;border-radius:999px;overflow:hidden}
  .timer>div{height:100%;background:var(--acc);width:100%;transition:width .2s linear}
  .name{padding:8px 10px;border:1px dashed #334155;border-radius:10px;background:#0e1630}
  .vote-btn{display:block;width:100%;text-align:left;margin:6px 0;padding:10px 12px;border-radius:10px;border:1px solid #1f2937;background:#0e1630;cursor:pointer}
  .vote-btn.sel{border-color:var(--acc)}
  .cat-chip{display:inline-block;margin:3px 6px 3px 0;padding:4px 8px;border-radius:999px;background:#0e1630;border:1px solid #1f2937}
</style>
</head>
<body>
<div class="wrap">
  <header class="row" style="justify-content:space-between">
    <div>
      <h1>Whosus? â€“ Impostor (Multi-Kategorien)</h1>
      <div class="row"><span class="pill">Offline â€¢ Pass-&-Play</span><span class="pill">>350 WÃ¶rter</span></div>
    </div>
    <button class="ghost" onclick="showHelp()">Regeln</button>
  </header>

  <!-- Setup -->
  <div id="screen-setup" class="card">
    <h2>Spiel vorbereiten</h2>
    <div class="grid">
      <div class="card">
        <h3>Spieler:innen</h3>
        <div class="row">
          <input id="name-in" placeholder="Name eingeben & hinzufÃ¼gen" onkeydown="if(event.key==='Enter') addPlayer()"/>
          <button class="primary" onclick="addPlayer()">HinzufÃ¼gen</button>
          <button class="ghost" onclick="quickFill()">Schnelles FÃ¼llen</button>
        </div>
        <div id="names" class="row"></div>
      </div>

      <div class="card">
        <h3>Einstellungen</h3>
        <div class="row" style="width:100%">
          <label class="pill">Rundendauer</label>
          <select id="dur">
            <option value="60">60 s</option><option value="90" selected>90 s</option><option value="120">120 s</option>
          </select>
          <label class="pill">Impostors</label>
          <select id="impc">
            <option value="1" selected>1</option>
            <option value="2">2</option>
          </select>
          <label class="pill" title="Wie viele Kategorien sollen pro Runde gemischt werden?">Anzahl Kategorien</label>
          <select id="kcount"></select>
        </div>
        <div class="small muted">Tipp: Mind. 3 Spieler:innen. Kategorien unten anhaken â†’ das Spiel pickt pro Runde <b>k</b> davon.</div>
      </div>

      <div class="card">
        <h3>Kategorien auswÃ¤hlen</h3>
        <div id="cat-list" class="grid"></div>
      </div>
    </div>

    <div class="row center">
      <button class="primary big" onclick="startRound()">Runde starten</button>
    </div>
  </div>

  <!-- Reveal -->
  <div id="screen-reveal" class="card" style="display:none">
    <h2 id="rev-title">Geheime EnthÃ¼llung</h2>
    <p class="muted">Aktive Kategorien in dieser Runde:</p>
    <div id="active-cats" class="row" style="margin-bottom:8px"></div>
    <p class="muted">Gib das GerÃ¤t an <b id="rev-name">Name</b>. Tippe, um dein Wort zu sehen â€“ dann sofort verdecken.</p>
    <div class="center" style="min-height:180px">
      <button id="rev-btn" class="big" onclick="toggleReveal()">Zeigen</button>
    </div>
    <div class="row center">
      <button onclick="prevReveal()">ZurÃ¼ck</button>
      <button class="primary" onclick="nextReveal()">Weiter</button>
    </div>
  </div>

  <!-- Discuss -->
  <div id="screen-discuss" class="card" style="display:none">
    <h2>Hinweise & Diskussion</h2>
    <div class="timer"><div id="tbar"></div></div>
    <div class="row center" style="margin-top:10px">
      <button class="primary" onclick="goVote()">Zur Abstimmung</button>
      <button class="ghost" onclick="pauseTimer()">Pause</button>
      <button class="ghost" onclick="resumeTimer()">Weiter</button>
    </div>
  </div>

  <!-- Vote -->
  <div id="screen-vote" class="card" style="display:none">
    <h2>Abstimmung</h2>
    <div id="vote-list"></div>
    <div class="row">
      <button onclick="revealResult()">Auswerten</button>
      <button class="ghost" onclick="toggleTie()">Stechen-Modus umschalten</button>
    </div>
  </div>

  <!-- Result -->
  <div id="screen-result" class="card" style="display:none">
    <h2 id="res-title">Ergebnis</h2>
    <p id="res-desc" class="muted"></p>
    <div class="row">
      <button class="primary" onclick="newWordSamePlayers()">Weiter â€“ neues Wort</button>
      <button onclick="backToSetup()">ZurÃ¼ck zum Setup</button>
    </div>
  </div>

  <div class="card muted small">Jetzt neu: WÃ¤hle <b>Anzahl Kategorien</b> (k) â€“ jede Runde mischt WÃ¶rter aus k Kategorien. WÃ¶rter-Pool: >350.</div>
</div>

<script>
/* ======= Kategorien & >350 WÃ¶rter ======= */
const WORDS = {
  "WM / FuÃŸball": [
    "Elfmeter","Abseits","FreistoÃŸ","Ecke","Torwart","Verteidiger","StÃ¼rmer","Mittelfeld",
    "Halbzeit","Nachspielzeit","Gelbe Karte","Rote Karte","VAR","Abwehrkette","Flanke",
    "Konter","Dribbling","Pressing","AbstoÃŸ","AnstoÃŸ","Latte","Pfosten","Volley","Kopfball",
    "Handspiel","GrÃ¤tsche","Passspiel","Doppelpass","Offensivfoul","RÃ¼ckpass","Auswechslung",
    "Trikot","Schienbeinschoner","Trainerbank","Spielfeldrand","Anhang","Fangesang","Choreografie",
    "Heimspiel","AuswÃ¤rtsspiel","Derby","Spielplan","Gruppenphase","K.-o.-Runde","Achtelfinale",
    "Viertelfinale","Halbfinale","Finale","Pokal","Weltmeister","Gastgeber","Nach Elfmetern"
  ],
  "Tiere": [
    "Elefant","Tiger","LÃ¶we","Giraffe","Nashorn","Zebra","Pinguin","Koala","KÃ¤nguru","Panda",
    "Delfin","Hai","Wal","Eule","Fuchs","Wolf","BÃ¤r","Leopard","Gepard","Nilpferd","Krokodil",
    "Krake","Seestern","Qualle","Ameise","Biene","Libelle","Schmetterling","MarienkÃ¤fer",
    "ErdmÃ¤nnchen","Dachs","Otter","Igel","Maulwurf","Fledermaus","Papagei","Flamingo","Pfau",
    "StrauÃŸ","Alpaka","Lama","Yak","Rentier","Murmeltier","Marder","WaschbÃ¤r","Elch","VielfraÃŸ","Schakal","Warzenschwein"
  ],
  "Essen & Trinken": [
    "Pizza","Burger","Sushi","Tacos","Falafel","Currywurst","Bratwurst","Sauerkraut","KÃ¤sespÃ¤tzle",
    "Lasagne","Carbonara","Ramen","Pho","Curry","Pad Thai","Paella","Hummus","Guacamole","Maultaschen",
    "DÃ¶ner","Burrito","Gyros","Hotdog","Onigiri","Gulasch","Fondue","Raclette","Pesto","Tiramisu",
    "Baklava","Apfelstrudel","SchwarzwÃ¤lder Kirschtorte","Kaiserschmarrn","Brezel","KÃ¤sekuchen",
    "Quiche","Risotto","Tapas","Tortilla","Churros","Shakshuka","Kimchi","Bibimbap","Sauerteig",
    "Latte Macchiato","Espresso","Cappuccino","Eistee","Limonade","Mate","Kombucha"
  ],
  "StÃ¤dte & Orte": [
    "Berlin","Hamburg","MÃ¼nchen","KÃ¶ln","Frankfurt","Stuttgart","Dresden","Leipzig","Bremen","Hannover",
    "Dortmund","Essen","DÃ¼sseldorf","NÃ¼rnberg","Heilbronn","St. Pauli","Sylt","Zugspitze","Schwarzwald",
    "RÃ¼gen","Konstanz","Heidelberg","TÃ¼bingen","Freiburg","Aachen","Bamberg","Weimar","Potsdam",
    "Krakau","Warschau","Danzig","Prag","Wien","ZÃ¼rich","Genf","Paris","Lyon","London","Manchester",
    "Madrid","Barcelona","Rom","Mailand","Venedig","Lissabon","Porto","New York","Los Angeles","Toronto","Mexiko-Stadt"
  ],
  "Alltagsdinge": [
    "SchlÃ¼ssel","Geldbeutel","KopfhÃ¶rer","Ladekabel","Powerbank","Regenschirm","Brille","Notizbuch",
    "Kuli","Taschenmesser","Taschenlampe","Handcreme","Desinfektionsgel","Haargummi","USB-Stick",
    "Rucksack","Trinkflasche","Brotdose","Kaugummi","TaschentÃ¼cher","Fahrausweis","EC-Karte","Ausweis",
    "Studentenausweis","Fitnessband","Smartwatch","Maus","Tastatur","Monitor","Adapter","Mehrfachsteckdose",
    "Klebeband","Schere","Heftklammern","BÃ¼roklammer","Briefumschlag","Feuerzeug","Streichholz",
    "Kerze","Luftpumpe","Fahrradschloss","Schloss","GÃ¼rtel","MÃ¼tze","Handschuh","Schal","Maske","Pflaster","Thermobecher","Kalender"
  ],
  "Berufe": [
    "Ã„rztin/Arzt","Lehrkraft","Ingenieur:in","Programmierer:in","Architekt:in","Mechaniker:in",
    "Elektriker:in","BÃ¤cker:in","Konditor:in","Koch/KÃ¶chin","Kellner:in","Pilot:in","Flugbegleiter:in",
    "Polizist:in","Feuerwehr","SanitÃ¤ter:in","Fotograf:in","Journalist:in","Designer:in","Produktmanager:in",
    "VerkÃ¤ufer:in","Apotheker:in","Chemiker:in","Physiker:in","Biolog:in","GÃ¤rtner:in","Schreiner:in",
    "Installateur:in","Dachdecker:in","Maler:in","Friseur:in","Therapeut:in","Psycholog:in","Anwalt/AnwÃ¤ltin",
    "Richter:in","Notar:in","Steuerberater:in","Zahnarzt/ZahnÃ¤rztin","Tierarzt:TierÃ¤rztin","Hebamme",
    "Logistiker:in","LokfÃ¼hrer:in","Busfahrer:in","Kurier:in","Data Scientist","Mechatroniker:in","Laborant:in","Ãœbersetzer:in","Bibliothekar:in","Sozialarbeiter:in"
  ],
  "Marken & Technik": [
    "Apple","Samsung","Google","Microsoft","Sony","Nintendo","PlayStation","Xbox","Tesla","BMW",
    "Mercedes","Audi","Volkswagen","Porsche","Ikea","Zara","H&M","Adidas","Nike","Reebok",
    "Asics","New Balance","Canon","Nikon","GoPro","DJI","Bose","Sennheiser","Beats","Dyson",
    "Philips","Siemens","Bosch","Miele","Whirlpool","Ionos","AWS","Azure","Stackit","GitHub",
    "Slack","Discord","WhatsApp","Instagram","TikTok","YouTube","Snapchat","Spotify","Netflix","Prime Video"
  ],
  "Filme & Serien (allg.)": [
    "Star Wars","Herr der Ringe","Harry Potter","Game of Thrones","Breaking Bad","Stranger Things",
    "The Dark Knight","Inception","Interstellar","Oppenheimer","Barbie","Forrest Gump","Gladiator",
    "Titanic","Matrix","Avatar","Shrek","Toy Story","Cars","Coco","Der Pate","Fight Club",
    "Pulp Fiction","The Boys","The Office","Friends","How I Met Your Mother","Sherlock","Lupin",
    "Prison Break","Peaky Blinders","Vikings","Narcos","Black Mirror","Wednesday","Suits","Dune",
    "Top Gun","Mission: Impossible","John Wick","Rocky","Creed","Jurassic Park","Frozen","Moana",
    "Encanto","Inside Out","WallÂ·E","Up","Ratatouille"
  ],
  "Sport allgemein": [
    "Tennis","Basketball","Handball","Volleyball","Leichtathletik","Schwimmen","Rudern","Segeln",
    "Boxen","MMA","Ringen","Fechten","Turnen","Skispringen","Biathlon","Snowboard","Eishockey",
    "Baseball","Cricket","Rugby","Badminton","Tischtennis","Radfahren","Triathlon","Marathon",
    "HÃ¼rdenlauf","Speerwurf","Weitsprung","KugelstoÃŸen","Hochsprung","Diskus","Surfen","Klettern",
    "Parkour","Skaten","Bouldern","Golf","Darts","Billard","Bowling","Reiten","Dressur","Polo",
    "Kajak","Kanu","Motorsport","Formel 1","Rallye","Motocross","eSport"
  ],
  "LÃ¤nder & Flaggen": [
    "Deutschland","Frankreich","Italien","Spanien","Portugal","Niederlande","Belgien","Ã–sterreich","Schweiz","Polen",
    "Tschechien","Slowakei","Ungarn","DÃ¤nemark","Schweden","Norwegen","Finnland","Island","Irland","Vereinigtes KÃ¶nigreich",
    "USA","Kanada","Mexiko","Brasilien","Argentinien","Chile","Uruguay","Peru","Kolumbien","Venezuela",
    "Japan","SÃ¼dkorea","China","Indien","Thailand","Vietnam","Indonesien","Malaysia","Singapur","Philippinen",
    "Ã„gypten","Marokko","Tunesien","SÃ¼dafrika","Nigeria","Kenia","Ã„thiopien","TÃ¼rkei","Saudi-Arabien","VAE"
  ],
  "Schule & Campus": [
    "Whiteboard","Beamer","Tafel","Kreide","Schwamm","Lineal","Geodreieck","Zirkel","Taschenrechner","Block",
    "Ordner","Heft","MÃ¤ppchen","Markierer","Textmarker","Korrekturroller","Collegeblock","Klausur","Referat","Hausarbeit",
    "Seminar","Vorlesung","Tutorium","Mensa","Cafeteria","Bibliothek","Skript","Handout","Projektor","Stuhlreihe",
    "Stundenplan","Pausengong","Sporthalle","Musikraum","Chemielabor","Reagenzglas","Bunsenbrenner","Pipette","Mikroskop","Waage",
    "Notebook","Tablet","WLAN","Hotspot","Webcam","Headset","Aufnahme","Cloud","Drucker","Scanner"
  ],
  "Random SpaÃŸ": [
    "Klebebart","EntenfÃ¼ÃŸe","Bananenschale","Konfettikanone","Seifenblasen","Wasserpistole","Luftballon",
    "Glitzer","Neonstift","Gaffer Tape","Quietsche-Ente","Kaugummiblase","Emoji-Kissen","Blinklicht",
    "Katzenhaar","Pizzakarton","Sockenmonster","Keksdose","Popcornmaschine","Wackeldackel","Schneekugel",
    "ZauberwÃ¼rfel","Jo-Jo","Yo-Yo-Trick","Springseil","Hula-Hoop","Wasserkocher","Toaster",
    "Mikrowelle","Backofen","Staubsauger","Hauspantoffel","Kapuzenpulli","Jogginghose","Sonnenbrille",
    "Badeente","Magnet","Post-it","Stickeralbum","Klebepistole","Locher","Tacker","Klammeraffe","FlaschenÃ¶ffner","SchlÃ¼sselband","USB-Hub","Lichtschwert","Keksstempel","WÃ¤scheklammer","Geldkatze"
  ]
};
const CAT_KEYS = Object.keys(WORDS);
const TOTAL_WORDS = Object.values(WORDS).reduce((n,a)=>n+a.length,0);

/* ======= UI-Build: Kategorien-Checkboxen & k-Auswahl ======= */
function buildCategoryChecklist(){
  const box = document.getElementById("cat-list");
  box.innerHTML = "";
  CAT_KEYS.forEach((k, idx)=>{
    const wrap = document.createElement("label");
    wrap.className = "row";
    wrap.style.alignItems = "center";
    wrap.style.gap = "8px";
    wrap.style.border = "1px solid #1f2937";
    wrap.style.borderRadius="10px";
    wrap.style.padding="8px";
    const cb = document.createElement("input");
    cb.type = "checkbox"; cb.value = k; cb.checked = idx < 3; // default: 3 vorausgewÃ¤hlt
    const span = document.createElement("span");
    span.innerHTML = `<b>${k}</b> <span class="muted small">(${WORDS[k].length})</span>`;
    wrap.appendChild(cb); wrap.appendChild(span);
    box.appendChild(wrap);
  });

  // k-Dropdown 1..max
  const kSel = document.getElementById("kcount");
  kSel.innerHTML = "";
  for(let i=1;i<=CAT_KEYS.length;i++){
    const op = document.createElement("option");
    op.value = i; op.textContent = i+" Kategorie"+(i>1?"n":"");
    if(i===2) op.selected = true; // default k=2
    kSel.appendChild(op);
  }
}
buildCategoryChecklist();

/* ======= State ======= */
let players = [];
let roundWord = "";
let activeCats = [];
let impostors = []; // indexe
let revealIdx = 0;
let votes = {}; // name->count
let timerInt=null, timeLeft=0, tieMode=false;

/* ======= Helpers ======= */
function $(id){return document.getElementById(id)}
function swap(scr){
  ["screen-setup","screen-reveal","screen-discuss","screen-vote","screen-result"].forEach(s=>$(s).style.display="none");
  $(scr).style.display="block";
}
function renderPlayers(){
  const box = $("names"); box.innerHTML="";
  players.forEach((p,i)=>{
    const span=document.createElement("span"); span.className="name";
    span.textContent = p;
    span.title="Zum Entfernen klicken";
    span.onclick=()=>{ players.splice(i,1); renderPlayers(); };
    box.appendChild(span);
  });
}
function addPlayer(){
  const val = $("name-in").value.trim();
  if(!val) return;
  if(players.includes(val)) return alert("Name existiert schon.");
  players.push(val); $("name-in").value="";
  renderPlayers();
}
function quickFill(){
  const pool=["Alex","Ben","Chi","Dana","Emil","Fay","Gio","Hila","Ivo","Jona","Kim","Luca","Mara","Niko","Oli","Pia","Quin","Ria","Sam","Tara"];
  while(players.length<6){ const n=pool[Math.floor(Math.random()*pool.length)]; if(!players.includes(n)) players.push(n); }
  renderPlayers();
}
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }

/* ======= Round Logic ======= */
function pickActiveCategories(k){
  // user-checked categories
  const checked = [...document.querySelectorAll("#cat-list input[type=checkbox]:checked")].map(cb=>cb.value);
  let base = checked.length ? checked.slice() : CAT_KEYS.slice();
  // falls weniger als k gewÃ¤hlt â†’ zufÃ¤llig auffÃ¼llen
  const missing = Math.max(0, k - base.length);
  if(missing>0){
    const remaining = CAT_KEYS.filter(c=>!base.includes(c));
    shuffle(remaining);
    base = base.concat(remaining.slice(0, missing));
  }
  // falls mehr als k gewÃ¤hlt â†’ zufÃ¤llig auf k reduzieren
  if(base.length>k){
    shuffle(base);
    base = base.slice(0, k);
  }
  return base;
}
function startRound(){
  const k = parseInt($("kcount").value, 10);
  if(players.length<3) return alert("Mindestens 3 Spieler:innen.");
  const impCount = parseInt($("impc").value,10);
  if(impCount>=players.length) return alert("Zu viele Impostors fÃ¼r die Personenzahl.");

  // Kategorien auswÃ¤hlen
  activeCats = pickActiveCategories(k);

  // Wortpool vereinen
  let union = [];
  activeCats.forEach(c=>union = union.concat(WORDS[c]));
  if(union.length===0) return alert("Keine WÃ¶rter verfÃ¼gbar.");
  roundWord = union[Math.floor(Math.random()*union.length)];

  // Impostor(s) losen
  impostors = [];
  const idxs = players.map((_,i)=>i);
  shuffle(idxs);
  for(let i=0;i<impCount;i++) impostors.push(idxs[i]);

  // Reset & UI
  revealIdx = 0; votes = {}; tieMode=false;
  $("rev-title").textContent = `Geheime EnthÃ¼llung (${union.length} mÃ¶gliche WÃ¶rter)`;
  renderActiveCats();
  $("rev-name").textContent = players[0];
  $("rev-btn").textContent = "Zeigen";
  swap("screen-reveal");
}
function renderActiveCats(){
  const box = $("active-cats"); box.innerHTML="";
  activeCats.forEach(c=>{
    const chip=document.createElement("span"); chip.className="cat-chip"; chip.textContent=c;
    box.appendChild(chip);
  });
}
function isImpostor(i){ return impostors.includes(i); }
function toggleReveal(){
  const btn=$("rev-btn");
  const i=revealIdx;
  if(btn.textContent==="Zeigen"){
    if(isImpostor(i)){
      btn.textContent = "IMPOSTOR â€“ ???";
    }else{
      btn.textContent = `Wort: ${roundWord}`;
    }
  }else{
    btn.textContent = "Zeigen";
  }
}
function nextReveal(){
  if(revealIdx<players.length-1){
    revealIdx++;
    $("rev-name").textContent = players[revealIdx];
    $("rev-btn").textContent = "Zeigen";
  }else{
    beginDiscuss();
  }
}
function prevReveal(){
  if(revealIdx>0){
    revealIdx--;
    $("rev-name").textContent = players[revealIdx];
    $("rev-btn").textContent = "Zeigen";
  }
}

/* ======= Diskussion / Timer ======= */
function beginDiscuss(){
  const dur=parseInt($("dur").value,10);
  startTimer(dur);
  swap("screen-discuss");
}
function startTimer(seconds){
  stopTimer(); timeLeft=seconds;
  $("tbar").style.width="100%";
  timerInt=setInterval(()=>{
    timeLeft-=0.1;
    $("tbar").style.width = Math.max(0, (timeLeft/seconds))*100 + "%";
    if(timeLeft<=0){ stopTimer(); goVote(); }
  },100);
}
function stopTimer(){ if(timerInt){ clearInterval(timerInt); timerInt=null; } }
function pauseTimer(){ stopTimer(); }
function resumeTimer(){ if(!timerInt){ startTimer(Math.max(1,Math.ceil(timeLeft))); } }

/* ======= Voting ======= */
function goVote(){
  stopTimer();
  const list=$("vote-list"); list.innerHTML="";
  votes={};
  players.forEach(p=>{
    const b=document.createElement("button"); b.className="vote-btn"; b.textContent=p;
    b.onclick=()=>{ b.classList.toggle("sel"); };
    list.appendChild(b);
  });
  swap("screen-vote");
}
function toggleTie(){
  tieMode=!tieMode;
  alert(tieMode ? "Stechen-Modus: Es darf genau eine Person gewÃ¤hlt werden." : "Normalmodus: Mehrere kÃ¶nnen anklicken.");
}
function revealResult(){
  const sels=[...document.querySelectorAll(".vote-btn.sel")].map(b=>b.textContent);
  if(tieMode && sels.length!==1) return alert("Stechen-Modus: wÃ¤hle genau EINE Person.");
  if(sels.length===0) return alert("Niemand gewÃ¤hlt. WÃ¤hlt mindestens eine Person.");

  votes={}; sels.forEach(n=>votes[n]=(votes[n]||0)+1);
  let top=[]; let max=0;
  for(const [n,c] of Object.entries(votes)){ if(c>max){max=c;top=[n]} else if(c===max){top.push(n)} }
  let accused = top[Math.floor(Math.random()*top.length)];

  const accusedIdx = players.indexOf(accused);
  const accusedIsImpostor = isImpostor(accusedIdx);
  const impNames = impostors.map(i=>players[i]).join(", ");
  const title = accusedIsImpostor ? "Treffer!" : "Daneben!";
  const desc = (accusedIsImpostor
    ? `Ihr habt ${accused} gewÃ¤hlt. Korrekt ðŸŽ¯.`
    : `Ihr habt ${accused} gewÃ¤hlt â€“ leider falsch.`)
    + `\nImpostor: ${impNames}\nAktive Kategorien: ${activeCats.join(", ")}\nGeheimes Wort: â€ž${roundWord}â€œ.`;
  $("res-title").textContent = title;
  $("res-desc").textContent = desc;
  swap("screen-result");
}

/* ======= Next / Reset ======= */
function newWordSamePlayers(){ startRound(); }
function backToSetup(){ swap("screen-setup"); }

/* ======= Regeln ======= */
function showHelp(){
  const msg = `Regeln (Kurz):
â€“ WÃ¤hle Anzahl Kategorien (k) und hake beliebige Kategorien an.
â€“ Pro Runde werden k Kategorien aktiv (aus deinen HÃ¤kchen; wenn zu wenige, wird aufgefÃ¼llt; wenn zu viele, wird zufÃ¤llig gekÃ¼rzt).
â€“ Wort kommt aus dem vereinten Pool dieser k Kategorien.
â€“ Alle auÃŸer dem/den Impostor(s) sehen das gleiche Wort; Impostor sieht â€žIMPOSTOR â€“ ???â€œ.
â€“ Hinweise â†’ Abstimmung â†’ Auswertung.`;
  alert(msg);
}

/* ======= Initial UI ======= */
(function init(){
  renderPlayers();
})();
</script>
</body>
</html>